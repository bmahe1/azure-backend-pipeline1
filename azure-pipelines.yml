trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  ACR_NAME: backendazure
  IMAGE_NAME: knowledgecity-backend
  TAG: $(Build.BuildId)

steps:

# Login to ACR using service connection
- task: Docker@2
  displayName: "ðŸ”‘ Login to ACR"
  inputs:
    command: login
    containerRegistry: backend-acr

# Build Image
- task: Docker@2
  displayName: "ðŸ›  Build Docker Image"
  inputs:
    command: build
    repository: $(ACR_NAME).azurecr.io/$(IMAGE_NAME)
    dockerfile: backend/Dockerfile
    tags: |
      $(TAG)

# Push Image
- task: Docker@2
  displayName: "ðŸš€ Push Docker Image"
  inputs:
    command: push
    repository: $(ACR_NAME).azurecr.io/$(IMAGE_NAME)
    tags: |
      $(TAG)
