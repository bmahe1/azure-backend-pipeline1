trigger:
  branches:
    include:
      - main

variables:
  imageName: knowledgecity-backend
  containerRegistry: backendcntainer
  aksCluster: Backend-cluster
  aksNamespace: kube-system

stages:
  - stage: Build
    displayName: "Build and Push Docker Image"
    jobs:
      - template: .azuredevops/pipelines/templates/build-stage.yml

  - stage: SecurityScan
    displayName: "Run Trivy Scan"
    dependsOn: Build
    jobs:
      - template: .azuredevops/pipelines/templates/security-scan.yml

  - stage: Deploy
    displayName: "Deploy to AKS"
    dependsOn: SecurityScan
    jobs:
      - template: .azuredevops/pipelines/templates/deploy-stage.yml
